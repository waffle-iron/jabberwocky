"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Auth=function(){function e(t,n,a){_classCallCheck(this,e),this.user=!1,this.auth=t,this.showLogin=n,this.showChat=a}return _createClass(e,[{key:"createUser",value:function(e,t){this.auth.createUserWithEmailAndPassword(e,t).catch(function(e){return e.message})}},{key:"signIn",value:function(e,t){return this.auth.signInWithEmailAndPassword(e,t).catch(function(e){return errorMessage=e.message})}},{key:"signOut",value:function(){this.auth.signOut().then(function(){this.showLogin()}).catch(function(e){})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Messages=function(){function e(t,n){_classCallCheck(this,e),this.database=t,this.aes=n}return _createClass(e,[{key:"send",value:function(e,t){var n=this;return this.database.ref("messages/").push({date:Date(),user:t,message:n.aes.encrypt(e,t)}).key}},{key:"read",value:function(e){var t=this;firebase.database().ref("messages/").on("child_added",function(n){t.update(e,n.val())})}},{key:"update",value:function(e,t){var n=document.getElementById(e),a=document.createElement("div"),s=document.createElement("span"),r=document.createElement("span"),o=document.createElement("span");a.className="msg",s.className="date",r.className="user",o.className="content";var u=new Date(t.date);u=u.getMonth()+1+"/"+u.getDate()+"/"+u.getFullYear();var c=document.createTextNode(t.user),i=document.createTextNode(u),l=document.createTextNode(this.aes.decrypt(t.message,t.user));s.appendChild(i),r.appendChild(c),o.appendChild(l),a.appendChild(r),a.appendChild(s),a.appendChild(o),n.appendChild(a)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Aes=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"encrypt",value:function(e,t){return CryptoJS.AES.encrypt(e,t).toString()}},{key:"decrypt",value:function(e,t){return CryptoJS.AES.decrypt(e,t).toString(CryptoJS.enc.Utf8)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Jabberwocky=function(){function t(e,n){_classCallCheck(this,t),this.showLogin(),this.auth=e,this.messages=n,this.email="",this.observer()}return _createClass(t,[{key:"showLogin",value:function(){var e=document.getElementById("login"),t=document.getElementById("main");t.innerHTML="";var n=document.importNode(e.content,!0);t.appendChild(n),document.getElementById("login__btn").onclick=function(){var e=document.getElementById("username"),t=document.getElementById("password");auth.signIn(e.value,t.value);return!1}}},{key:"sendMessage",value:function(){var e=this,t=document.getElementById("msg");if(""!=t.value)return e.messages.send(t.value,e.email),t.value="",!1}},{key:"showChat",value:function(){var t=this;document.getElementById("login").style.display="none";var n=document.getElementById("chat"),a=document.getElementById("main");a.innerHTML="";var s=document.importNode(n.content,!0);a.appendChild(s),document.getElementById("send").onclick=this.sendMessage,msg.onkeypress=function(){13==e.keyCode&&t.sendMessage()},document.getElementById("logout").onclick=function(){return t.auth.signOut(),t.showLogin(),!1},this.messages.read("msgs")}},{key:"observer",value:function(){var e=this;this.auth.onAuthStateChanged(function(t){t&&(e.email=t.email,e.showChat())})}}]),t}(),fbAuth=firebase.auth(),database=firebase.database(),messages=new Messages(database,new Aes),auth=new Auth(fbAuth),jw=new Jabberwocky(fbAuth,messages);