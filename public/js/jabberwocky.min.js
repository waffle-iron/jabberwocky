"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Auth=function(){function e(t,n,a){_classCallCheck(this,e),this.user=!1,this.auth=t,this.showLogin=n,this.showChat=a}return _createClass(e,[{key:"createUser",value:function(e,t){this.auth.createUserWithEmailAndPassword(e,t).catch(function(e){return e.message})}},{key:"signIn",value:function(e,t){return this.auth.signInWithEmailAndPassword(e,t).catch(function(e){return errorMessage=e.message})}},{key:"signOut",value:function(){this.auth.signOut().then(function(){this.showLogin()}).catch(function(e){})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Messages=function(){function e(t,n){_classCallCheck(this,e),this.database=t,this.aes=n}return _createClass(e,[{key:"send",value:function(e,t){var n=this;return this.database.ref("messages/").push({date:Date(),user:t,message:n.aes.encrypt(e,t)}).key}},{key:"read",value:function(e){var t=this;firebase.database().ref("messages/").on("child_added",function(n){t.update(e,n.val())})}},{key:"update",value:function(e,t){var n=document.getElementById(e),a=document.createElement("div"),r=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span");a.className="msg",r.className="date",s.className="user",o.className="content";var i=new Date(t.date);i=i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear();var c=document.createTextNode(t.user),u=document.createTextNode(i),l=document.createTextNode(this.aes.decrypt(t.message,t.user));r.appendChild(u),s.appendChild(c),o.appendChild(l),a.appendChild(s),a.appendChild(r),a.appendChild(o),n.appendChild(a),n.scrollTop=n.scrollHeight}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Aes=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"encrypt",value:function(e,t){return CryptoJS.AES.encrypt(e,t).toString()}},{key:"decrypt",value:function(e,t){return CryptoJS.AES.decrypt(e,t).toString(CryptoJS.enc.Utf8)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Profile=function(){function e(t){_classCallCheck(this,e),this.database=t,this.nickname="pond hoe"}return _createClass(e,[{key:"load",value:function(){var e=this,t=firebase.auth().currentUser.uid;firebase.database().ref("/profiles/"+t).once("value").then(function(t){var n=t.val().nickname;e.nickname=n});var n=document.getElementById("profile"),a=document.getElementById("head_main"),r=document.importNode(n.content,!0);a.appendChild(r),document.getElementById("profile__save").onclick=function(){var t=document.getElementById("nickname");return e.nickname=t.value,e.database.ref("profiles/"+firebase.auth().getUid()+"/").set({date:Date(),nickname:t.value}).key}}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Jabberwocky=function(){function e(t,n,a){_classCallCheck(this,e),this.showLogin(),this.showRegister(),this.auth=t,this.messages=n,this.email="",this.profile=a,this.observer()}return _createClass(e,[{key:"showLogin",value:function(){var e=document.getElementById("login"),t=document.getElementById("main");t.innerHTML="";var n=document.importNode(e.content,!0);t.appendChild(n),document.getElementById("login__btn").onclick=function(){var e=document.getElementById("username"),t=document.getElementById("password");auth.signIn(e.value,t.value);return!1}}},{key:"showRegister",value:function(){var e=document.getElementById("register"),t=document.getElementById("main"),n=document.importNode(e.content,!0);t.appendChild(n),document.getElementById("register__btn").onclick=function(){var e=document.getElementById("register__username"),t=document.getElementById("register__password"),n=document.getElementById("reigster__confirm_password");if(t.value===n.value){auth.createUser(e.value,t.value);return!1}console.error("passwords do not match")}}},{key:"sendMessage",value:function(){var e=this,t=document.getElementById("msg");if(""!=t.value)return console.log(e.nickname),e.messages.send(t.value,e.profile.nickname),t.value="",!1}},{key:"showChat",value:function(){var e=this;document.getElementById("login").style.display="none";var t=document.getElementById("chat"),n=document.getElementById("main");n.innerHTML="";var a=document.importNode(t.content,!0);n.appendChild(a),document.getElementById("send").onclick=function(){e.sendMessage()},msg.onkeypress=function(t){13==t.keyCode&&e.sendMessage()},document.getElementById("logout").onclick=function(){return e.auth.signOut(),e.showLogin(),!1},this.messages.read("msgs")}},{key:"observer",value:function(){var e=this;this.auth.onAuthStateChanged(function(t){t&&(e.email=t.email,e.showChat(),e.nickname=e.profile.load())})}}]),e}(),fbAuth=firebase.auth(),database=firebase.database(),messages=new Messages(database,new Aes),auth=new Auth(fbAuth),profile=new Profile(database),jw=new Jabberwocky(fbAuth,messages,profile);